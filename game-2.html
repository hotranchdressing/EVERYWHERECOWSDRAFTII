<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Crowd Pen</title>
<style>
  body {
    background: radial-gradient(circle at center, #050505, #000);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    overflow: hidden;
    font-family: sans-serif;
  }

  .board {
    display: grid;
    grid-template-rows: repeat(5, 80px);
    grid-template-columns: repeat(3, 80px);
    gap: 6px;
    transform-style: preserve-3d;
    transform: rotateZ(-120deg) skewY(-20deg) skewX(-15deg); 
    position: relative;
  }

  .tile {
    position: relative;
    background: #111;
    border: 1px solid #222;
    cursor: pointer;
    transition: background 0.3s, box-shadow 0.3s, transform 0.1s;
  }

  .tile.active {
    background: #333;
  }

  .tile.clicked {
    background: #8f8;
    box-shadow: 0 0 15px #8f8;
    transform: translateY(-2px);
  }

  .object {
    position: absolute;
    top: -25%;
    left: -25%;
    width: 150%;
    height: 150%;
    pointer-events: none;
    transform: rotateZ(120deg) translateY(-50%);
    z-index: 1000;
  }

  .shadow {
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 100%;
    height: 10px;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0.4), transparent);
    pointer-events: none;
  }
</style>
</head>
<body>

<div class="board" id="board"></div>

<script>
  const board = document.getElementById('board');
  const activeRow = 2; // which row is currently clickable

  // Each tile will have an object image indicating a category of cattle byproducts, moving from most abstracted from the cow (fuels, distilled chemicals) to least (meat).
  const tileData = [
    { row: 1, col: 1, object: 'images/skeleton.png' },
    { row: 1, col: 2, object: 'images/skeleton.png' },
    { row: 1, col: 3, object: 'images/skeleton.png' },
    { row: 2, col: 1, object: 'images/skeleton.png' },
    { row: 2, col: 2, object: 'images/skeleton.png' },
    { row: 2, col: 3, object: 'images/skeleton.png' },
    { row: 3, col: 1, object: 'images/skeleton.png' },
    { row: 3, col: 2, object: 'images/skeleton.png' },
    { row: 3, col: 3, object: 'images/skeleton.png' },
    { row: 4, col: 1, object: 'images/skeleton.png' },
    {row: 4, col: 2, object: 'images/skeleton.png' },
    { row: 4, col: 3, object: 'images/skeleton.png' },
    { row: 5, col: 1, object: 'images/skeleton.png' },
    { row: 5, col: 2, object: 'images/skeleton.png' },
    { row: 5, col: 3, object: 'images/skeleton.png' },
  ];

  // Create tiles
  tileData.forEach(data => {
    const tile = document.createElement('div');
    tile.classList.add('tile');
    tile.dataset.row = data.row;
    tile.dataset.col = data.col;

    // Object image floating above tile
    const objectImg = document.createElement('img');
    objectImg.classList.add('object');
    objectImg.src = data.object;
    tile.appendChild(objectImg);

    // Shadow under object
    const shadow = document.createElement('div');
    shadow.classList.add('shadow');
    tile.appendChild(shadow);

    board.appendChild(tile);
  });

  // Highlight only the active row
  function illuminateRow(row) {
    const tiles = document.querySelectorAll('.tile');
    tiles.forEach(tile => {
      if (Number(tile.dataset.row) === row) tile.classList.add('active');
      else tile.classList.remove('active');
    });
  }

  illuminateRow(activeRow);

  // User works their way to end of each row -- some images or text appear when each tile gets clicked -- when all tiles in a row are clicked, user enters a different intermediate environment.
  function checkRowCompletion(row) {
    const rowTiles = Array.from(document.querySelectorAll('.tile'))
      .filter(t => Number(t.dataset.row) === row);
    const allClicked = rowTiles.every(t => t.classList.contains('clicked'));
    if (allClicked) {
      // navigate to interlude page for this row
      setTimeout(() => {
        window.location.href = `interlude-${row}.html`;
      }, 400);
    }
  }

  // Tile click toggles clicked state
  board.addEventListener('click', e => {
    const tile = e.target.closest('.tile');
    if (!tile) return;
    const row = Number(tile.dataset.row);

    if (row === activeRow) {
      tile.classList.toggle('clicked'); // glow toggles
      checkRowCompletion(row);
    }
  });
</script>

</body>
</html>